name: Hexo Auto Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set Up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.19.0'
          cache: 'npm'

      - name: Install Dependencies
        run: |
          npm install -g hexo-cli
          npm install

      - name: Generate Static Files
        run: hexo clean && hexo generate

      # ğŸ‘‡ é‡ç‚¹ä¿®æ”¹è¿™éƒ¨åˆ†ï¼šé€‚é… v4 æ’ä»¶çš„æ–°å‚æ•° + ç”¨ PAT ä»¤ç‰Œè®¤è¯
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          # 1. æ›¿æ¢æˆä½ çš„ Pages ä»“åº“ï¼ˆæ ¼å¼ï¼šç”¨æˆ·å/ä»“åº“åï¼Œä¸ç”¨å¸¦ git@ å‰ç¼€ï¼‰
          external_repository: git@github.com:yating1022/yating1022.github.io.git
          # 2. Pages ä»“åº“çš„åˆ†æ”¯ï¼ˆmain æˆ– gh-pagesï¼‰
          publish_branch: main
          # 3. éƒ¨ç½²ç›®å½•ï¼ˆå›ºå®š publicï¼‰
          publish_dir: ./public
          # 4. ç”¨ PAT ä»¤ç‰Œè®¤è¯ï¼ˆå¯¹åº”ä½ é…ç½®çš„ Secrets åç§°ï¼‰
          personal_token: ${{ secrets.HEXO_DEPLOY_TOKEN }}
          # 5. è‡ªåŠ¨éƒ¨ç½²çš„æäº¤ä¿¡æ¯
          commit_message: 'Auto deploy: ${{ github.sha }}'
